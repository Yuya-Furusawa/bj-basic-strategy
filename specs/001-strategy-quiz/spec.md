# Feature Specification: Blackjack Basic Strategy Quiz

**Feature Branch**: `001-strategy-quiz`
**Created**: 2025-11-23
**Status**: Draft
**Input**: User description: "ブラックジャックのベーシックストラテジーを覚えるためのクイズを出してくれるシンプルなモバイルアプリの仕様"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - クイズでベーシックストラテジーを学習する (Priority: P1)

ユーザーはアプリを起動し、ランダムに出題されるブラックジャックの手札に対して、正しいアクション（Hit/Stand/Double/Split）を選択することで、ベーシックストラテジーを暗記する。

**Why this priority**: これがアプリの核心機能であり、ユーザーが最も求めている価値。クイズを通じてベーシックストラテジーを効率的に学習できる。

**Independent Test**: アプリを起動し、スタートボタンをタップしてクイズを開始し、表示された手札に対してアクションを選択し、正誤フィードバックを受け取れることで検証可能。

**Acceptance Scenarios**:

1. **Given** ユーザーがトップページにいる状態, **When** スタートボタンをタップ, **Then** クイズ画面に遷移し、ディーラーのアップカードとプレイヤーの手札が表示される
2. **Given** クイズ画面で手札が表示されている, **When** 4つのアクションボタン（Hit/Stand/Double/Split）のいずれかをタップ, **Then** 正誤判定が即座に表示される
3. **Given** 正解を選択した場合, **When** 判定が表示される, **Then** 緑色で「Correct!」と表示される
4. **Given** 不正解を選択した場合, **When** 判定が表示される, **Then** 赤色で「Wrong! Answer: [正解]」と表示される
5. **Given** 正誤判定が表示されている, **When** 「Next Hand」ボタンをタップ, **Then** 新しい手札が表示される
6. **Given** クイズ画面にいる状態, **When** 戻るボタンをタップ, **Then** トップページに遷移しクイズセッションが終了する（問題数制限なし）

---

### User Story 2 - 連続正解記録（ストリーク）を確認する (Priority: P2)

ユーザーは自分の連続正解数を確認し、モチベーションを維持しながら学習を続ける。

**Why this priority**: ゲーミフィケーション要素として学習継続のモチベーションを高める重要な機能。

**Independent Test**: クイズに連続で正解し、ストリーク数が増加することを確認。不正解時にリセットされることを確認。

**Acceptance Scenarios**:

1. **Given** クイズ画面にいる状態, **When** 正解を選択, **Then** 画面上部のストリーク表示が1増加する
2. **Given** ストリークが5の状態, **When** 不正解を選択, **Then** ストリークが0にリセットされる
3. **Given** ストリークが現在の最高記録を超えた, **When** 正解を選択, **Then** 最高記録が更新され保存される

---

### User Story 3 - 最高記録を確認する (Priority: P3)

ユーザーはトップページで自分の全期間最高記録を確認し、過去の成果を振り返る。

**Why this priority**: 長期的な学習成果の可視化により、継続的な利用を促進する。

**Independent Test**: 最高記録を達成後、アプリを終了して再起動し、最高記録が保持されていることを確認。

**Acceptance Scenarios**:

1. **Given** トップページ, **When** 画面を表示, **Then** 最高記録が「Best Streak: [数値]」形式で表示される
2. **Given** 最高記録を更新した後, **When** アプリを終了して再起動, **Then** 更新された最高記録が表示される

---

### Edge Cases

- プレイヤーの手札がペアでない場合、Splitボタンは視覚的に選択可能だが、選択した場合は不正解となる
- 初回起動時は最高記録が0として表示される
- アプリがバックグラウンドに移動した際、現在のクイズ状態は保持される

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは完全ランダムにハンドタイプ（ハード/ソフト/ペア）を選択し、プレイヤーの手札とディーラーのアップカードを生成しなければならない（MUST）。ハンドタイプは均等配分（各約33%）とし、同じ問題が連続で出題される可能性がある
- **FR-002**: システムはベーシックストラテジーテーブルに基づいて正解を判定しなければならない（MUST）
- **FR-003**: ユーザーは4つのアクションボタン（Hit/Stand/Double/Split）から選択できなければならない（MUST）
- **FR-004**: システムは正誤判定を視覚的にフィードバックしなければならない（MUST）。正解時は緑色で「Correct!」、不正解時は赤色で「Wrong! Answer: [正解アクション]」を表示（理由説明なし）
- **FR-005**: システムは現在の連続正解数（ストリーク）をリアルタイムで表示しなければならない（MUST）
- **FR-006**: システムは全期間の最高記録を永続的に保存しなければならない（MUST）
- **FR-007**: システムは不正解時に現在のストリークを0にリセットしなければならない（MUST）
- **FR-008**: システムはオフライン環境でも完全に動作しなければならない（MUST）
- **FR-009**: トップページからクイズ画面へ、クイズ画面からトップページへの遷移ができなければならない（MUST）

### Key Entities

- **クイズ問題（QuizHand）**: プレイヤーの手札（2枚のカード）、ディーラーのアップカード（1枚）、ハンドタイプ（ハード/ソフト/ペア）、正解アクション
- **アクション**: Hit、Stand、Double、Split の4種類
- **ストリーク記録**: 現在の連続正解数、全期間最高記録
- **カード**: スート（ハート/ダイヤ/クラブ/スペード）とランク（2-10、J、Q、K、A）。画像形式で表示

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは3タップ以内でクイズを開始できる（トップページ表示 → スタートボタン → クイズ開始）
- **SC-002**: 正誤判定は選択後0.5秒以内に表示される
- **SC-003**: アプリ起動から操作可能状態まで3秒以内
- **SC-004**: クイズ1問あたりの平均所要時間が10秒以内で完了可能
- **SC-005**: 最高記録は端末ローカルに保存され、アプリ再起動後も100%保持される
- **SC-006**: すべての270通りの手札パターン（プレイヤーハンド × ディーラーアップカード）をカバーする
- **SC-007**: ネットワーク接続なしでもすべての機能が利用可能

## Clarifications

### Session 2025-11-23

- Q: クイズ問題はどのように出題されるべきですか？ → A: 完全ランダム（同じ問題が連続で出る可能性あり）
- Q: クイズ画面でカードはどのように表示されるべきですか？ → A: カード画像（トランプのビジュアル表示）
- Q: 不正解時に表示される情報はどこまで詳しくすべきですか？ → A: 正解アクションのみ（例: "Answer: Stand"）
- Q: 3種類のハンドタイプの出題頻度はどうすべきですか？ → A: 均等（各タイプ約33%ずつ）
- Q: クイズはどのように終了しますか？ → A: 無限（ユーザーが戻るボタンで終了するまで続く）

## Assumptions

- ベーシックストラテジーは標準的な6デッキルール（ディーラーはソフト17でスタンド、ダブルダウンは全ての手札で可能、スプリット後のダブルダウン可能）に基づく
- Surrenderオプションは本アプリのスコープ外とする
- ユーザー認証やクラウド同期は不要（ローカルのみのデータ保存）
- カード画像はパブリックドメインのVector Playing Cards 3.2を使用
- 対象ユーザーは17歳以上（ギャンブル関連コンテンツ）
